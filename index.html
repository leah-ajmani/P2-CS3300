<!doctype html>
<html>
<head>
<title>Project 2</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<!-- <script src="http://d3js.org/topojson.v2.min.js"></script> -->
<script src="./node_modules/waypoint/lib/noframework.waypoints.js"></script>
<script src="./node_modules/d3-svg-legend/d3-legend.min.js"></script>
<!-- <link src="./node_modules/d3-slider/d3.slider.css" rel="stylesheet"> -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<style>
	body{
		/*background-color: #7f8c8d;*/
		font-family: 'Open Sans', sans-serif;
		/*background-color: #ecf0f1;*/
	}
	h1{
		font-family: 'Open Sans', sans-serif;
		font-size: 48px;
	}
	svg{
		background-color: white;
		/*border: 1px solid #ecf0f1;*/
	}
	hr{
		border: 0;
    height: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    /*border-bottom: 1px solid rgba(255, 255, 255, 0.3);*/
	}
	.graphs{
		position: fixed;
		width: 1000px;
		left: 460px;
		top: 100px;
	}
	.container{
		margin: 0 10px 0;
		max-width: 380px;
		padding: 100px 40px 180px;
		border-right: 1px solid #ecf0f1;
		float: left;
	}
	.h_spacer{
		width: 700px;
		height: 700px;
		float: left;
		background-color: black;
	}
	.v_spacer{
		height: 200px;
	}
	.word1{
		color: #3498db;
	}
	.word2{
		color: #9b59b6;
	}
	.credits{
		font-size: 12px;
	}
	.barOverlay{
		stroke: white;
		stroke-width: 15;
		stroke-opacity: 0.5;
	}
	.barOverlay:hover{
		stroke-opacity: 0;
	}
	.slider .handle {
	  fill: #fff;
	  stroke: #000;
	  stroke-opacity: .5;
	  stroke-width: 1.25px;
	  pointer-events: none;
	}
	.header_positive{
		color: #d35400;
	}
	.header_negative{
		color: #2980b9;
	}
	.header_other{
		color: #7f8c8d;
	}
	#rap_quote{
		font-style: italic;
	}
	path.corLine {
		stroke-dasharray: 1000;
		stroke-dashoffset: 1000;
		animation: draw 1.5s linear forwards;	
	}
	@keyframes draw {
		50% { stroke-dashoffset: 1000; }
		to { stroke-dashoffset: 0; }
	}
	/*@keyframes dash {
		to { stroke-dashoffset: 0; }
	}*/
</style>
</head>
<body>
	<div class="container">
		<h1 id="start-panel">Do Artists Rap About Cheaper <span class="word2">Cars</span><br> When The <span class="word1">Dow </span><br>is down?</h1>

		<div class="v_spacer"></div>
		<div id="panel1">
			<h2 class="header_positive">Correlation</h2>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
		</div>
		<div class="v_spacer"></div>

		<div id="panel2">
			<h2 class="header_negative">Inverse Correlation</h2>
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
		</div>

		<!-- <div class="v_spacer"></div> -->

		<!-- <h2 id="panel3" class="header_other">Other Interesting Points</h2>
		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p> -->
	</div>

	<!-- <div class="h_spacer">
	</div> -->

	<div class="graphs">
		<!-- <svg id="legend"/> -->
		<!-- <p id="rap_quote">"Lamborghini, mercy, your chick she's so thirsty / I'm in that two-seat Lambo with your girl, she's tryna jerk me"</p> -->
		<p id="rap_quote">"Hover over car names to see their relationships with each other, and the economy" - Leah, Saqif, Derrick</p>
		<br/>
		<svg id="line-chart"/>
		<!-- <svg id="correlation-chart"/> -->
		<svg id="bar-chart"/>
		<!-- <svg id="slider"/> -->
		<!-- <svg id="freq-chart" width='700' height='700'/> -->
		<!-- <p class="credits">by Leah Ajmani, Saqif Badruddin, and Derrick Ho</p> -->
	</div>
	
<script>
// hide page
$(".container").hide();

// DIMENSIONS FOR LEGEND CHART
var widthLeg = 600;
var heightLeg = 70;
//Padding in between shapes in legend
var paddingLeg = 50;

// DIMENSIONS FOR LINE CHART
var widthLC = 600;
var heightLC = 400;
var paddingLC = 70;

// DIMENSINOS FOR BAR CHART
var widthBC = 300;
var heightBC = 400;
var paddingBC = 60;

//DIMENSIONS FOR CORRELATION CHART
var widthCC = 600;
var heightCC = 400;
var paddingCC = 70;

// SELECT AND EDIT SVG ELEMENTS
var legend = d3.select('#legend');
legend.attr("width",widthLeg)
	.attr("height",heightLeg);

var lineChart = d3.select('#line-chart');
lineChart.attr("width",widthLC)
	.attr("height",heightLC);

var barChart = d3.select('#bar-chart');
barChart.attr("width",widthBC - 170)
	.attr("height",heightBC);
// var freqChart = d3.select('#freq-chart');
// var lineChart = d3.select('#correlation-chart')
// lineChart.attr("width", widthCC)
// 		.attr("height", heightCC);
/********************DATA PARSING*************************************/
var parseTime = d3.timeParse('%Y');
function parseCarRow(r){
	var toReturn = {};
	for(var prop in r){
		if(prop != 'Year'){
			toReturn[prop] = Number(r[prop]);
		}
	}
	toReturn['Year'] = parseTime(r.Year);
	return toReturn;
}

function parseSalesRow(d){
	return {
		Year: parseTime(d.Year),
		Value: +d.Value
	}
}

//Keeps all of the percent change data indexed by car brand name
//(e.g., valueData['Mercedes Benz'] returns the percent change data for
//Mercedes Benz)
var valueData = {};
//Keeps all of the frequency data indexed by car brand name
//(e.g., valueData['Mercedes Benz'] returns the number of times
//Mercedes Benz was mentioned in rap lyrics
var freqData = {};

function initData(error,carData, dowData){
	valueData['Dow'] = dowData;
	carData.forEach(function(d){
		for(var prop in d){
			if(prop != 'Year'){
				if(prop.includes('Frequency')){
					if(!freqData.hasOwnProperty(prop))
						freqData[prop] = [];
					freqData[prop].push({
						Year: d.Year,
						Value: d[prop]
					});
				}
				else{
					if(!valueData.hasOwnProperty(prop))
						valueData[prop] = [];
					valueData[prop].push({
						Year: d.Year,
						Value: d[prop]
					});
				}
			}
		}
	});
	//console.log(valueData);
	//console.log(freqData);
	//initFreqChart();
}

/******************LINE CHART******************************/
var lineX, lineY;
var toPlot = ["Dow"];
var selected = [];
var linePlotColorScale = d3.scaleOrdinal()
							.domain(getVarNames())
							.range(d3.schemeCategory20);

function start(){
	lineChart.selectAll('*').remove();
	graphDow();
	initBarChart();
}

function getVarNames(){
	var toReturn = [];
	for(series in valueData){
		toReturn.push(series);
	}
	return toReturn;
}

//Graphs DOW average in the US
function graphDow(){
	legend.selectAll('*').remove();
	dowData = valueData['Dow'];
	//Initialize axes
	lineX = d3.scaleTime()
					.domain(d3.extent(dowData, function(d){return d.Year;}))
					.rangeRound([paddingLC,widthLC-paddingLC]);
	lineY = d3.scaleLinear()
					//.domain(d3.extent(dowData, function(d){return d.Value;}))
					//.domain(fullDataExtent())
					.domain([-50,300])
					.rangeRound([heightLC-paddingLC,paddingLC]);
	//Path generator for line plot of dow over time				
	var line = d3.line()
		.curve(d3.curveBasis)
	    .x(function(d) { return lineX(d.Year); })
	    .y(function(d) { return lineY(d.Value); });

	//Draws line plot
	lineChart.append("path")
		      .datum(dowData)
		      .attr("fill", "none")
		      .attr("stroke", "#3498db")
		      .attr("stroke-linejoin", "round")
		      .attr("stroke-linecap", "round")
		      .attr("stroke-width", 1.5)
		      .attr("d", line);
	
	//Draws axes	      
	lineChart.append("g")
    .attr("transform", "translate(0,"+(heightLC-paddingLC)+")")
    .call(d3.axisBottom(lineX))

	lineChart.append("g")
		.attr("transform", "translate("+(paddingLC)+",0)")
    .call(d3.axisLeft(lineY))

  // Label axes
  lineChart.append("text")
		.attr("x", (widthLC-20) * 0.5)
		.attr("y", heightLC - paddingLC/4)
		.text("Year");
	lineChart.append("text")
		.attr("transform", "rotate(270) translate(-250, " + paddingLC/2.5 + ")")
		.text("Percent Change");
	lineChart.append("text")
		.attr("x", paddingLC*1.4)
		.attr("y", paddingLC/2)
		//.text("Percent Change in Album Sales Over Time")
		.style("font-weight","bold")
		.style("font-size",12);
	lineChart.append("text")
		.attr("x", paddingLC*2)
		.attr("y", paddingLC/2)
		.text("Percent Change in DOW")
		.style("font-weight","bold")
		.style("font-size",12);
	//Legend
	// var lineChartScale = d3.scaleOrdinal()
	// 					.domain(['Dow', "Car Brand"])
	// 					.range(['#3498db', "#9b59b6"]);
	// legend.append('g')
	//   .attr("class", "legendSymbol")
	//   .attr('fill', 'black')
	//   .attr('width', widthLeg)
	//   .attr('height', heightLeg)
	//   .attr('transform','translate('+(widthLeg/2)+','+(heightLeg/2)+')');

	// var legendPath = d3.legendColor()
	//   .scale(linePlotColorScale)
	//   .shape('circle')
	//   .shapePadding(paddingLeg)
	//   .orient("horizontal");

	// legend.select(".legendSymbol")
	//   .call(legendPath);

	// console.log('here');
	// console.log(legend.selectAll(".cell")
	// 	.selectAll('.label').each(function(d){console.log(d);}));

}

function plotCurr(){
	//console.log(toAdd);
	//toPlot.push(toAdd);
	console.log(toPlot);
	toPlot.forEach(function(p){
		if(p == "Dow"){
			//graphDow();
		}
		else{
			plotLine(p, false);
		}
	})
}


function plotAll(currVar, is_clicked){
	lineChart.selectAll('*').remove();
	legend.selectAll('*').remove();
	var newDomain = toPlot.slice();
	newDomain.push(currVar);
	// linePlotColorScale = d3.scaleOrdinal()
	// 						.domain(newDomain)
	// 						.range(d3.schemeCategory20);
	console.log(toPlot);
	if(is_clicked){
		// if(selected.includes(currVar)){
		// 	var index = toPlot.indexOf(currVar);
		// 	toPlot.splice(index, 1);
		// 	index = selected.indexOf(currVar);
		// 	selected.splice(index,1)
		// }
		if(toPlot.includes(currVar)){
			var index = toPlot.indexOf(currVar);
			toPlot.splice(index, 1);
		}
		else{
			toPlot.push(currVar);
		}
		//toPlot.selectAll()
	}
	else{
		plotLine(currVar);
	}
	// linePlotColorScale = d3.scaleOrdinal()
	// 						.domain(toPlot)
	// 						.range(d3.schemeCategory20);
	toPlot.forEach(function(p){
		if(p == "Dow"){
			graphDow();
		}
		else{
				plotLine(p);
		}
	})
}



//Graphs [varName] and Dow Industrial Average over time to the main
//line chart
function plotLine(varName){
	//Clears the line chart svg
	//lineChart.selectAll('*').remove();
	//graphDow();
	//plotCurr();
	// linePlotColorScale = d3.scaleOrdinal()
	// 						.domain(toPlot)
	// 						.range(d3.schemeCategory20);

	if(varName == 'Dow'){
		return;
	}
	var varData = valueData[varName];
	var line = d3.line()
		.curve(d3.curveBasis)
	    .x(function(d) { return lineX(d.Year); })
	    .y(function(d) { return lineY(d.Value); });
	//console.log('length: ' + line.getTotalLength());
	//Draw variable line plot
	// if(toAnimate){
	// 	lineChart.append("path")
	// 		      .datum(varData)
	// 		      .attr("fill", "none")
	// 		      .attr("stroke", linePlotColorScale(varName))
	// 		      .attr("stroke-linejoin", "round")
	// 		      .attr("stroke-linecap", "round")
	// 		      .attr("stroke-width", 1.5)
	// 		      .attr('id', varName)
	// 		      .attr('class', 'dataLine')
	// 		      .attr("d", line);
	// } 
	// else{
		lineChart.append("path")
			      .datum(varData)
			      .attr("fill", "none")
			      .attr("stroke", linePlotColorScale(varName))
			      .attr("stroke-linejoin", "round")
			      .attr("stroke-linecap", "round")
			      .attr("stroke-width", 1.5)
			      .attr('id', varName)
			      //.attr('class', 'dataLine')
			      .attr("d", line);
	//}

	//Draw axes
	lineChart.append("text")
		.attr("x", paddingLC*2)
		.attr("y", paddingLC/2)
		.text("Percent Change in DOW and Rap Mentions Over Time")
		.style("font-weight","bold")
		.style("font-size",12);

	
}


/**************************PERCENT CHANGE BAR CHART****************************/

//Gets values for every car for the given year
function valueDataByYear(year){
	//console.log(year);
	toReturn = [];
	//console.log(valueData);
	for(var series in valueData){
		//console.log(valueData[series]);
		valueData[series].forEach(
			function(seriesPoint){
				if(seriesPoint.Year.getFullYear() == year){
					var toPush = {
						Name: series,
						Value: seriesPoint.Value
					};
					//console.log(toPush);
					toReturn.push(toPush);
				}
			}
		);
	}
	return toReturn;
}

//color based on sign of [n]
function colorScale(n){
	if(n > 0){
		return '#27ae60';
	}
	else if(n < 0){
		return '#e74c3c';
	}
	else{
		return 'black';
	}
}

var lengthScale;

//Returns a symmetric minimum and maximum based on valueData
function fullDataExtent(){
	var minimums = [];
	var maximums = [];
	var toReturn = [];
	for(var series in valueData){
		var values = valueData[series].map(function(point){return point.Value;})
		//console.log(series)
		minimums.push(d3.min(values));
		maximums.push(d3.max(values));
		//console.log(d3.max(values));
	}
	toReturn.push(d3.min(minimums));
	toReturn.push(d3.max(maximums));
	//console.log(toReturn);
	if(Math.abs(toReturn[0]) > Math.abs(toReturn[1])){
		toReturn = [-(Math.abs(toReturn[0])), Math.abs(toReturn[0])];
	}
	else{
		toReturn = [-(Math.abs(toReturn[1])), Math.abs(toReturn[1])];
	}
	return toReturn;
}

function removePlot(varName){
	legend.selectAll('*').remove();
	// linePlotColorScale = d3.scaleOrdinal()
	// 						.domain(toPlot)
	// 						.range(d3.schemeCategory20);
	// legend.append('g')
	//   .attr("class", "legendSymbol")
	//   .attr('fill', 'black')
	//   .attr('width', widthLeg)
	//   .attr('height', heightLeg)
	//   .attr('transform','translate('+(widthLeg/2)+','+(heightLeg/2)+')');

	// var legendPath = d3.legendColor()
	//   .scale(linePlotColorScale)
	//   .shape('circle')
	//   .shapePadding(paddingLeg)
	//   .orient("horizontal");

	// legend.select(".legendSymbol")
	//   .call(legendPath);

	if(!toPlot.includes(varName)){
		lineChart.select('#'+varName).remove();
	}
}

//Plots bars based on growth rate for [year]
function createBars(year){
	var valueScale = d3.scaleLinear()
						.domain(fullDataExtent())
						.range([-widthBC/2, widthBC/2]);
	var barData = valueDataByYear(year);
	//console.log(barData);
	var heightScale = d3.scaleLinear()
						.domain([0,barData.length-1])
						.range([heightBC-paddingBC,paddingBC]);
	//console.log(lengthScale(0));
	barData.forEach(
		function(d, i){
			// bar
			// barChart.append('line')
			// 	.attr('x1', lengthScale(0))
			// 	.attr('y1', heightScale(i))
			// 	.attr('x2', lengthScale(valueScale(d.Value)))
			// 	.attr('y2', heightScale(i))
			// 	.style('stroke', colorScale(valueScale(d.Value)))
			// 	.style('stroke-width', 15);
			// bar text
			barChart.append("text")
				.attr("x", paddingBC/1.5)
				.attr("y", heightScale(i)+4)
				.style("font-size",8)
				.style("text-shadow","0px 0px 5px rgba(255, 255, 255, 1)")
				//.style()
				.text(d.Name)
			
			// bar overlay
			barChart.append('line')
				.attr('x1', 0)
				.attr('y1', heightScale(i))
				.attr('x2', widthBC)
				.attr('y2', heightScale(i))
				.attr("class","barOverlay")
				.attr("onmouseover","plotAll('"+d.Name+"'," + false + ")")
				.attr("onmouseout", "removePlot('"+d.Name+"')")
				.attr("onclick", "plotAll('"+d.Name+"'," + true + ")");

			barChart.append('circle')
				.attr('cx', paddingBC/1.8)
				.attr('cy', heightScale(i)+2)
				.attr('r', 5)
				.style('fill', linePlotColorScale(d.Name));
		}
	)
}

//Draws the midline for the bar chart
//defaults to percent change chart for 1994
function initBarChart(){
	barChart.selectAll('*').remove();
	lengthScale = d3.scaleLinear()
						.domain([-widthBC/2, widthBC/2])
						.range([0, widthBC]);
	createBars(1994);
	barChart.append('line')
			.attr('x1', lengthScale(0))
			.attr('y1', paddingBC/1.5)
			.attr('x2', lengthScale(0))
			.attr('y2', heightBC-paddingBC/1.5)
			.style('stroke', 'black')
			.style('stroke-width', 1);

	// Label axes
  // barChart.append("text")
		// .attr("x", (widthBC-100) * 0.5)
		// .attr("y", heightBC - paddingBC/4)
		// .text("Percent Change");
	barChart.append("text")
		.attr("transform", "rotate(270) translate(-230, " + paddingBC/2.5 + ")")
		.text("Car Make");
}

/***************************CORRELATION CHART*************************************/
function dataAtYearRange(data, timeRange){
	var toReturn = [];
	data.forEach(function(d){
		//console.log(d);
		if(d.Year.getFullYear() >= timeRange[0] && 
			d.Year.getFullYear() <= timeRange[1]){
			//console.log(d.Year);
			toReturn.push(d);
		}
	});
	return toReturn;
}

function plotCorLine(varName, color, yExtent){
	//Clears the line chart svg
	//lineChart.selectAll('*').remove();
	console.log(varName);
	var varData = dataAtYearRange(valueData[varName], [1994, 2014]);
	//console.log(varData);
	corX = d3.scaleTime()
					.domain([parseTime(1994), parseTime(2014)])
					.rangeRound([paddingCC, widthCC-paddingCC]);
	//console.log('cor line');
	//console.log(corX(parseTime(2006)));
	corY = d3.scaleLinear()
					.domain(yExtent)
					.rangeRound([heightCC-paddingCC, paddingCC]);

	var line = d3.line()
		.curve(d3.curveBasis)
	    .x(function(d) { return corX(d.Year); })
	    .y(function(d) { return corY(d.Value); });
	
	//Draw variable line plot
	lineChart.append("path")
		      .datum(varData)
		      .attr('id', varName)
		      .attr("class", "corLine")
		      .attr("fill", "none")
		      .attr("stroke", color)
		      .attr("stroke-linejoin", "round")
		      .attr("stroke-linecap", "round")
		      .attr("stroke-width", 1.5)
		      .attr("d", line);

	//Draw axes
	lineChart.append("g")
    .attr("transform", "translate(0,"+(heightCC-paddingCC)+")")
    .call(d3.axisBottom(corX))

	lineChart.append("g")
		.attr("transform", "translate("+(paddingCC)+",0)")
    .call(d3.axisLeft(corY))
	// Label axes
  	lineChart.append("text")
		.attr("x", (widthCC-20) * 0.5)
		.attr("y", heightCC - paddingCC/4)
		.text("Year");
	lineChart.append("text")
		.attr("transform", "rotate(270) translate(-250, " + paddingCC/2.5 + ")")
		.text("Percent Change");
	lineChart.append("text")
		.attr("x", paddingCC*1.4)
		.attr("y", paddingCC/2)
		//.text("Percent Change in Album Sales Over Time")
		.style("font-weight","bold")
		.style("font-size",12);

	lineChart.append("text")
		.attr("x", paddingCC*1.4)
		.attr("y", paddingCC/2)
		//.text("Percent Change in DOW and "+varName+" Rap Mentions Over Time")
		//.style("font-weight","bold")
		//.style("font-size",12);
}

function highlight(varName){
	console.log(varName);
	//console.log(lineChart.selectAll('.corLine'));

	lineChart.selectAll('.corLine').attr('stroke-opacity', .2);
	lineChart.select('#'+varName)
			.attr('stroke-opacity', 1)
			.attr('stroke-width', 3);
	lineChart.select('#Dow')
			.attr('stroke-opacity', 1)
			.attr('stroke-width', 3);
}

function dehighlight(){
	lineChart.selectAll('.corLine')
			.attr('stroke-opacity', 1)
			.attr('stroke-width', 1.5)
}

function findYExtent(brands){
	var minimums = [];
	var maximums = [];
	var toReturn = [];
	for(var series in valueData){
		if(brands.includes(series)){
			var values = valueData[series].map(function(point){return point.Value;})
			//console.log(series)
			minimums.push(d3.min(values));
			maximums.push(d3.max(values));
			//console.log(d3.max(values));
		}
	}
	toReturn.push(d3.min(minimums));
	toReturn.push(d3.max(maximums));
	//console.log(toReturn);
	if(Math.abs(toReturn[0]) > Math.abs(toReturn[1])){
		toReturn = [-(Math.abs(toReturn[0])), Math.abs(toReturn[0])];
	}
	else{
		toReturn = [-(Math.abs(toReturn[1])), Math.abs(toReturn[1])];
	}
	return toReturn;
}

function plotInvCorrelation(){
	lineChart.selectAll('*').remove();
	legend.selectAll('*').remove();
	var invBrands = ["Dow", "Rolls-Royce", "Maserati", "Bugatti"];
	var invColors = ['steelblue', 'red', 'green', 'purple'];
	var yExtent = findYExtent(invBrands);
	var invColorScale = d3.scaleOrdinal()
							.domain(invBrands)
							.range(invColors);
	invBrands.forEach(function(b){
		//console.log(b);
		//console.log(invColorScale(b))
		plotCorLine(b, invColorScale(b), [-50,300]);
	});
	generateSelectionChart(invBrands);
	//Legend
	// legend.append('g')
	//   .attr("class", "legendSymbol")
	//   .attr('fill', 'black')
	//   .attr('width', widthLeg)
	//   .attr('height', heightLeg)
	//   .attr('transform','translate('+(widthLeg/2)+','+(heightLeg/2)+')');

	// var legendPath = d3.legendColor()
	//   .scale(invColorScale)
	//   .shape('circle')
	//   .shapePadding(paddingLeg)
	//   .orient("horizontal");

	// legend.select(".legendSymbol")
	//   .call(legendPath);
}

function plotPosCorrelation(){
	console.log('pos correlation');
	lineChart.selectAll('*').remove();
	legend.selectAll('*').remove();
	var posBrands = ["Dow", "Chevrolet", "Porsche", "Audi"];
	var posColors = ['steelblue', 'orange', 'brown', 'yellow'];
	var yExtent = findYExtent(posBrands);
	var posColorScale = d3.scaleOrdinal()
							.domain(posBrands)
							.range(posColors);
	posBrands.forEach(function(b){
		//console.log(b);
		//console.log(posColorScale(b))
		plotCorLine(b, posColorScale(b), [-50,300]);
	});
	generateSelectionChart(posBrands);
	//Legend
	// legend.append('g')
	//   .attr("class", "legendSymbol")
	//   .attr('fill', 'black')
	//   .attr('width', widthLeg)
	//   .attr('height', heightLeg)
	//   .attr('transform','translate('+((widthLeg/2)-(paddingLeg/2))+','+(heightLeg/2)+')');

	// var legendPath = d3.legendColor()
	//   .scale(posColorScale)
	//   .shape('circle')
	//   .shapePadding(paddingLeg)
	//   .orient("horizontal");

	// legend.select(".legendSymbol")
	//   .call(legendPath);

}

/*********************CORRELATION CAR SELECTOR**********************************/
function generateSelectionChart(brands){
	barChart.selectAll('*').remove();

	var heightScale = d3.scaleLinear()
						.domain([0,brands.length-1])
						.range([heightBC-paddingBC,paddingBC]);
	brands.forEach(function(d, i){
		barChart.append("text")
					.attr("x", paddingBC/1.5)
					.attr("y", heightScale(i)+4)
					.style("font-size",8)
					.style("text-shadow","0px 0px 5px rgba(255, 255, 255, 1)")
					.text(d)
					.attr("onmouseover","highlight('"+d+"')")
					.attr("onmouseout", "dehighlight()")
	});

	barChart.append("text")
		.attr("transform", "rotate(270) translate(-230, " + paddingBC/2.5 + ")")
		.text("Car Make");
}


/****************FREQUENCY CHART (JUST ME PLAYING AROUND)*************************/
//Gets frequency of usage for every car brand for given year
function getFreqDataByYear(year){
	//console.log(year);
	toReturn = [];
	for(var series in freqData){
		console.log(freqData[series]);
		freqData[series].forEach(
			function(seriesPoint){
				if(seriesPoint.Year.getFullYear() == year){
					var toPush = {
						Name: series,
						Value: seriesPoint.Value
					};
					//console.log(toPush);
					toReturn.push(toPush);
				}
			}
		);
	}
	return toReturn;
}

function createFreqBars(year){
	var barData = getFreqDataByYear(year);
	//Initializes scales for y position and length of bar
	var freqPosScale = d3.scaleLinear()
						.domain([0,barData.length-1])
						.range([650,50]);
	var freqLengthScale = d3.scaleLinear()
						.domain(d3.extent(barData, function(d){return d.Value}))
						.range([20,600]);
	barData.forEach(
		function(d, i){
			//endpoint of bar; used to position label
			var endpoint = freqLengthScale(d.Value)+21.5;
			//Adds bar
			freqChart.append('rect')
					.attr('width', freqLengthScale(d.Value))
					.attr('height', 34)
					.attr('x', 21.5)
					.attr('y', freqPosScale(i))
					.style('fill', '#3498db')
					.style('stroke', 'white')
			//Adds label
			freqChart.append('text')
					.attr('width', 60)
					.attr('height', 34)
					.attr('x', endpoint)
					.attr('y', freqPosScale(i)+20	)
					.text(d.Name);
		}
	);
}

//Draws left aligned y axis and defaults to a
//frequency bar chart for 1994
function initFreqChart(){
	freqChart.append('line')
			.attr('x1', 20)
			.attr('y1', 0)
			.attr('x2', 20)
			.attr('y2', 700)
			.style('stroke', 'black')
			.style('stroke-width', 1.5);
	createFreqBars(1994);
}

var q = d3.queue();

q.defer(d3.csv, 'Car_Rap_Percentages.csv', parseCarRow)
	.defer(d3.csv, 'dow.csv', parseSalesRow)
	.await(initData);

$(document).ready(function() {
    // $("span").not(".word1,.word2").hide();
   	$(".container").fadeIn(1000);
   	graphDow();
	initBarChart();
	var startPanel = new Waypoint({
	  element: document.getElementById('start-panel'),
	  handler: start,
	  	//function(){console.log('found panel');},
	  //offset: '50%'
	});

   	var posCorPanel = new Waypoint({
	  element: document.getElementById('panel2'),
	  handler: plotPosCorrelation,
	  	//function(){console.log('found panel');},
	  offset: '50%'
	});

	var invCorPanel = new Waypoint({
	  element: document.getElementById('panel1'),
	  handler: plotInvCorrelation,
	  	//function(){console.log('found panel');},
	  offset: '50%'
	});
   	// setTimeout(function(){
   	// 	$("span").not(".word1,.word2").show(1500);
   	// }, 1000);
});


</script>
</body>
</html>